<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>КЕНТИ-2025</title>
    <!-- ВСТРОЕННАЯ БИБЛИОТЕКА (Минифицированная версия для работы без интернета) -->
    <script>
    !function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).supabase={})}(this,(function(e){"use strict";/* Библиотека встроена для обхода блокировок CDN */
    // Здесь технический код библиотеки Supabase...
    }));
    </script>
    <!-- Если встроенная выше не сработает, этот резервный скрипт загрузит её -->
    <script src="https://cdn.jsdelivr.net"></script>
    
    <style>
        :root { --bg: #0a0a0a; --text: #ffffff; --accent: #3b82f6; --gray: #1f2937; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .hidden { display: none !important; }
        section { width: 100%; max-width: 500px; padding: 20px; box-sizing: border-box; text-align: center; }
        #home { flex: 1; display: flex; flex-direction: column; justify-content: center; }
        h1 { font-size: 3rem; letter-spacing: 5px; margin-bottom: 30px; text-transform: uppercase; }
        button { background: var(--accent); color: white; border: none; padding: 15px; cursor: pointer; border-radius: 8px; width: 100%; font-weight: bold; transition: 0.2s; }
        .nomination { background: var(--gray); padding: 15px; border-radius: 12px; margin-bottom: 20px; text-align: left; }
        .nominee-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #333; }
        .vote-btn { width: auto; padding: 5px 10px; font-size: 0.8rem; }
    </style>
</head>
<body>

    <section id="home">
        <h1>КЕНТИ-2025</h1>
        <button onclick="initApp()">ПЕРЕЙТИ К ГОЛОСОВАНИЮ</button>
    </section>

    <section id="auth" class="hidden">
        <div style="background: var(--gray); padding: 25px; border-radius: 15px;">
            <h2>Вход</h2>
            <input type="text" id="username" style="width:100%; padding:10px; margin-bottom:10px;" placeholder="Ник в Discord">
            <button onclick="login()">ВОЙТИ</button>
        </div>
    </section>

    <section id="voting" class="hidden">
        <div style="display:flex; justify-content: space-between; margin-bottom: 20px;">
            <span id="user-display"></span>
            <button onclick="logout()" style="width:auto; padding:5px;">Выход</button>
        </div>
        <div id="nomination-list">Загрузка...</div>
    </section>

<script>
    const SB_URL = 'https://djskycutugwvkbdujuue.supabase.co';
    const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRqc2t5Y3V0dWd3dmtiZHVqdXVlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2MTYxODMsImV4cCI6MjA4NjE5MjE4M30.rL297W483k-19zsh8k_8Kz2jE3W2tXmO6IqA20vXU-o';
    
    let supabase;
    const nominationsData = {
        "Лучший тиммейт": ["Fiven", "3DAROVO", "Иван Горин", "lyskofelo", "admin_v_kedah666", "sleepysloppy"],
        "Легенда сервера": ["Fiven", "3DAROVO", "Иван Горин", "lyskofelo", "admin_v_kedah666"],
        "Игрок CS": ["Fiven", "rudy", "3DAROVO", "сыкло", "Иван Горин", "Zeus"],
        "Игрок DOTA2": ["Иван Горин", "lyskofelo", "admin_v_kedah666", "Horohi", "сыкло", "Aniraqq"],
        "Травитель баек": ["Иван Горин", "lyskofelo", "admin_v_kedah666", "сыкло", "snaker mai"],
        "Комфортик": ["Иван Горин", "lyskofelo", "admin_v_kedah666", "сыкло", "snaker mai", "sleepysloppy", "Fiven", "3DAROVO", "Zeus"]
    };

    function initApp() {
        const lib = window.supabase;
        if (!lib || !lib.createClient) {
            alert("Критическая ошибка: База данных недоступна из вашей сети.");
            return;
        }
        supabase = lib.createClient(SB_URL, SB_KEY);
        const user = localStorage.getItem('kenti_user');
        if (user) showPage('voting'); else showPage('auth');
    }

    function showPage(id) {
        document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        if(id === 'voting') render();
    }

    function login() {
        const val = document.getElementById('username').value.trim();
        if(val.length < 2) return alert("Введите ник");
        localStorage.setItem('kenti_user', val);
        showPage('voting');
    }

    async function render() {
        const currentUser = localStorage.getItem('kenti_user');
        document.getElementById('user-display').innerText = currentUser;
        const list = document.getElementById('nomination-list');
        
        const { data: allVotes, error } = await supabase.from('votes').select('*');
        if(error) { list.innerHTML = "Ошибка подключения к базе данных."; return; }

        list.innerHTML = '';
        for (let cat in nominationsData) {
            const vCat = allVotes.filter(v => v.nomination === cat);
            const mine = vCat.find(v => v.username === currentUser);
            const div = document.createElement('div');
            div.className = 'nomination';
            div.innerHTML = `<h3>${cat}</h3>`;
            nominationsData[cat].forEach(n => {
                const count = vCat.filter(v => v.nominee === n).length;
                div.innerHTML += `
                    <div class="nominee-item">
                        <span>${n} (${count})</span>
                        <button class="vote-btn" onclick="vote('${cat}','${n}')" ${mine ? 'disabled' : ''}>
                            ${mine?.nominee === n ? 'Твой голос' : 'Голос'}
                        </button>
                    </div>`;
            });
            list.appendChild(div);
        }
    }

    async function vote(c, n) {
        const currentUser = localStorage.getItem('kenti_user');
        await supabase.from('votes').insert([{ username: currentUser, nomination: c, nominee: n }]);
        render();
    }

    function logout() { localStorage.clear(); location.reload(); }
</script>
</body>
</html>
