<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–ï–ù–¢–ò-2025</title>
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Supabase -->
    <script src="https://cdn.jsdelivr.net"></script>
    <style>
        :root { --bg: #0a0a0a; --text: #ffffff; --accent: #3b82f6; --gray: #1f2937; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .hidden { display: none !important; }
        section { width: 100%; max-width: 500px; padding: 20px; box-sizing: border-box; text-align: center; }
        #home { flex: 1; display: flex; flex-direction: column; justify-content: center; }
        h1 { font-size: 3rem; letter-spacing: 5px; margin-bottom: 30px; text-transform: uppercase; }
        button { background: var(--accent); color: white; border: none; padding: 15px; cursor: pointer; border-radius: 8px; width: 100%; font-weight: bold; transition: 0.2s; }
        button:hover { opacity: 0.8; }
        button:disabled { background: #444; cursor: not-allowed; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid #333; color: white; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        .nomination { background: var(--gray); padding: 15px; border-radius: 12px; margin-bottom: 20px; text-align: left; }
        .nominee-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #333; }
        .vote-btn { width: auto; padding: 5px 10px; font-size: 0.8rem; }
        .winner-tag { color: #10b981; font-size: 0.8rem; display: block; margin-bottom: 10px; font-weight: bold; }
    </style>
</head>
<body>

    <section id="home">
        <h1>–ö–ï–ù–¢–ò-2025</h1>
        <button onclick="initApp()">–ü–ï–†–ï–ô–¢–ò –ö –ì–û–õ–û–°–û–í–ê–ù–ò–Æ</button>
    </section>

    <section id="auth" class="hidden">
        <div style="background: var(--gray); padding: 25px; border-radius: 15px;">
            <h2>–í—Ö–æ–¥</h2>
            <input type="text" id="username" placeholder="–ù–∏–∫ –≤ Discord">
            <button onclick="login()">–í–û–ô–¢–ò</button>
        </div>
    </section>

    <section id="voting" class="hidden">
        <div style="display:flex; justify-content: space-between; margin-bottom: 20px; align-items: center;">
            <span id="user-display" style="color: var(--accent); font-weight: bold;"></span>
            <button onclick="logout()" style="width:auto; background:#444; padding: 5px 10px; font-size: 0.8rem;">–í—ã—Ö–æ–¥</button>
        </div>
        <div id="nomination-list">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
    </section>

<script>
    // –¢–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ Supabase
    const SB_URL = 'https://djskycutugwvkbdujuue.supabase.co';
    const SB_KEY = 'sb_publishable_3vdH5vysyxj9IeywZvKbog_PEHXte66';
    
    let supabase;
    const nominationsData = {
        "–õ—É—á—à–∏–π —Ç–∏–º–º–µ–π—Ç": ["Fiven", "3DAROVO", "–ò–≤–∞–Ω –ì–æ—Ä–∏–Ω", "lyskofelo", "admin_v_kedah666", "sleepysloppy"],
        "–õ–µ–≥–µ–Ω–¥–∞ —Å–µ—Ä–≤–µ—Ä–∞": ["Fiven", "3DAROVO", "–ò–≤–∞–Ω –ì–æ—Ä–∏–Ω", "lyskofelo", "admin_v_kedah666"],
        "–ò–≥—Ä–æ–∫ CS": ["Fiven", "rudy", "3DAROVO", "—Å—ã–∫–ª–æ", "–ò–≤–∞–Ω –ì–æ—Ä–∏–Ω", "Zeus"],
        "–ò–≥—Ä–æ–∫ DOTA2": ["–ò–≤–∞–Ω –ì–æ—Ä–∏–Ω", "lyskofelo", "admin_v_kedah666", "Horohi", "—Å—ã–∫–ª–æ", "Aniraqq"],
        "–¢—Ä–∞–≤–∏—Ç–µ–ª—å –±–∞–µ–∫": ["–ò–≤–∞–Ω –ì–æ—Ä–∏–Ω", "lyskofelo", "admin_v_kedah666", "—Å—ã–∫–ª–æ", "snaker mai"],
        "–ö–æ–º—Ñ–æ—Ä—Ç–∏–∫": ["–ò–≤–∞–Ω –ì–æ—Ä–∏–Ω", "lyskofelo", "admin_v_kedah666", "—Å—ã–∫–ª–æ", "snaker mai", "sleepysloppy", "Fiven", "3DAROVO", "Zeus"]
    };

    function initApp() {
        if (!supabase) {
            supabase = window.supabase.createClient(SB_URL, SB_KEY);
        }
        const savedUser = localStorage.getItem('kenti_user');
        if (savedUser) { showPage('voting'); } else { showPage('auth'); }
    }

    function showPage(id) {
        document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        if(id === 'voting') render();
    }

    function login() {
        const val = document.getElementById('username').value.trim();
        if(val.length < 2) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫");
        localStorage.setItem('kenti_user', val);
        showPage('voting');
    }

    async function render() {
        const currentUser = localStorage.getItem('kenti_user');
        document.getElementById('user-display').innerText = `–ù–∏–∫: ${currentUser}`;
        const list = document.getElementById('nomination-list');
        
        try {
            const { data: allVotes, error } = await supabase.from('votes').select('*');
            if(error) throw error;

            list.innerHTML = '';
            for (let cat in nominationsData) {
                const vCat = allVotes.filter(v => v.nomination === cat);
                const mine = vCat.find(v => v.username === currentUser);
                
                const counts = {};
                vCat.forEach(v => counts[v.nominee] = (counts[v.nominee] || 0) + 1);
                let top = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b, null);

                const div = document.createElement('div');
                div.className = 'nomination';
                div.innerHTML = `<h3>${cat}</h3>${top ? `<span class="winner-tag">üèÜ –õ–∏–¥–µ—Ä: ${top} (${counts[top]})</span>` : ''}`;
                
                nominationsData[cat].forEach(n => {
                    const c = counts || 0;
                    div.innerHTML += `
                        <div class="nominee-item">
                            <span>${n} (${c})</span>
                            <button class="vote-btn" onclick="vote('${cat}','${n}')" ${mine ? 'disabled' : ''}>
                                ${mine?.nominee === n ? '–¢–≤–æ–π –≤—ã–±–æ—Ä' : (mine ? '‚Äî' : '–ì–æ–ª–æ—Å')}
                            </button>
                        </div>`;
                });
                list.appendChild(div);
            }
        } catch (e) {
            list.innerHTML = `<div style="color:red">–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (Policies) –≤ Supabase!</div>`;
        }
    }

    async function vote(c, n) {
        const currentUser = localStorage.getItem('kenti_user');
        await supabase.from('votes').insert([{ username: currentUser, nomination: c, nominee: n }]);
        render();
    }

    function logout() {
        localStorage.removeItem('kenti_user');
        location.reload();
    }

    if (localStorage.getItem('kenti_user')) {
        setTimeout(initApp, 500);
    }
</script>
</body>
</html>
